#!/bin/bash

export PS4='+${BASH_SOURCE}:${LINENO}:${FUNCNAME[0]:+${FUNCNAME[0]}():} '

set -e
set -u
set -o pipefail

function -print-usage {
    echo "Usage: $0 MAIN"
}

function -print-help {
    -print-usage
    cat <<EOH
Runs a MAIN entry point in Skratch.

MAIN can be one of:
   * benchmarks
   * fibs
EOH
}

while getopts :-: opt
do
    [[ - == $opt ]] && opt=${OPTARG%%=*} OPTARG=${OPTARG#*=}
    case $opt in
        h | help ) -print-help ; exit 0 ;;
        * ) -print-usage >&2 ; exit 2 ;;
    esac
done
shift $((OPTIND - 1))

case $# in
    0 ) -print-usage >&2 ; exit 2 ;;
    * ) cmd=$1 ; shift ;;
esac

case $cmd in
    agent ) main=jvmagent.AgentXKt ;;
    benchmarks ) main=benchmark.JustInTimeConstantsKt ;;
    fibs ) main=math.matrix.MathikKt ;;
    * ) -print-usage >&2 ; exit 2 ;;
esac

java -cp target/skratch-0-SNAPSHOT-shaded.jar "hm.binkley.labs.skratch.$main" "$@"
